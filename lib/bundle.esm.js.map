{"version":3,"file":"bundle.esm.js","sources":["../src/serializeCall.ts","../src/index.ts"],"sourcesContent":["/**\n * 序列化调用 返回true 或 resolve(true) 调用链终止\n * @param handles\n */\nexport default function (handles: Array<Function>) {\n  let index = -1;\n\n  function next(...args: any[]): any {\n    index++;\n\n    if(handles[index]){\n      const result = handles[index].call(window, ...args);\n\n      if(!result){\n        return next(...args);\n      }\n\n      if(result && result.then){\n        return result.then((res: boolean) => {\n          if(!res){\n            return next(...args);\n          }\n          return true;\n        });\n      }\n    }\n\n    return false;\n  }\n\n  return next;\n}\n","import serializeCall from \"./serializeCall\";\n\ntype Listener = (evt: Event) => void;\n\nconst listeners: Record<string, {\n  rootHandle: Listener;\n  handles: Array<Listener>,\n}> = {};\nconst addEventListenerOriginal = window.addEventListener;\nconst removeEventListenerOriginal = window.removeEventListener;\n\nwindow.addEventListener = function extendAddEventListener(...params: any[]) {\n  const eventName = params[0];\n  const handle = params[1];\n\n  if (!handle) {\n    return;\n  }\n\n  const listener = listeners[eventName];\n\n  if (listener) {\n    // 添加句柄\n    listener.handles.push(handle);\n  } else {\n    // @ts-ignore\n    addEventListenerOriginal.apply(window, params);\n  }\n};\n\nwindow.removeEventListener = function extendRemoveEventListener(...params: any[]) {\n  const eventName = params[0];\n  const handle = params[1];\n\n  if (!handle) {\n    return;\n  }\n\n  const listener = listeners[eventName];\n\n  if (listener) {\n    listener.handles.some((fn, index) => {\n      if(fn === handle){\n        // 剔除指定句柄\n        listener.handles.splice(index, 1);\n        return true;\n      }\n    });\n  } else {\n    // @ts-ignore\n    removeEventListenerOriginal.apply(window, params);\n  }\n};\n\n/**\n * 扩展window事件\n * @param extendEventNames 扩展事件名称\n * @example extendListeners('popstate', 'hashchange');\n */\nexport function extendListeners(...extendEventNames: string[]) {\n  extendEventNames.forEach((eventName) => {\n    // @ts-ignore\n    addEventListenerOriginal.call(window, eventName, extendHandle);\n    listeners[eventName] = {\n      rootHandle: extendHandle,\n      handles: [],\n    };\n\n    function extendHandle(event: Event) {\n      const listener = listeners[eventName];\n\n      const next = serializeCall(listener.handles);\n\n      next(event);\n    }\n  });\n}\n\n/**\n * 移除扩展window事件\n * @param extendEventNames 需要移除的扩展事件名称\n * @example removeExtendListeners('popstate', 'hashchange');\n */\nexport function removeExtendListeners(...extendEventNames: string[]) {\n  extendEventNames.forEach((eventName) => {\n    const listener = listeners[eventName];\n\n    if(listener){\n      removeEventListenerOriginal.call(window, eventName, listener.rootHandle);\n      delete listeners[eventName];\n    }\n  });\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;wBAIyB,OAAwB;IAC/C,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;IAEf,SAAS,IAAI;;QAAC,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,yBAAc;;QAC1B,KAAK,EAAE,CAAC;QAER,IAAG,OAAO,CAAC,KAAK,CAAC,EAAC;YAChB,IAAM,MAAM,GAAG,CAAA,KAAA,OAAO,CAAC,KAAK,CAAC,EAAC,IAAI,qBAAC,MAAM,GAAK,IAAI,EAAC,CAAC;YAEpD,IAAG,CAAC,MAAM,EAAC;gBACT,OAAO,IAAI,wBAAI,IAAI,GAAE;aACtB;YAED,IAAG,MAAM,IAAI,MAAM,CAAC,IAAI,EAAC;gBACvB,OAAO,MAAM,CAAC,IAAI,CAAC,UAAC,GAAY;oBAC9B,IAAG,CAAC,GAAG,EAAC;wBACN,OAAO,IAAI,wBAAI,IAAI,GAAE;qBACtB;oBACD,OAAO,IAAI,CAAC;iBACb,CAAC,CAAC;aACJ;SACF;QAED,OAAO,KAAK,CAAC;KACd;IAED,OAAO,IAAI,CAAC;CACb;;AC3BD,IAAM,SAAS,GAGV,EAAE,CAAC;AACR,IAAM,wBAAwB,GAAG,MAAM,CAAC,gBAAgB,CAAC;AACzD,IAAM,2BAA2B,GAAG,MAAM,CAAC,mBAAmB,CAAC;AAE/D,MAAM,CAAC,gBAAgB,GAAG,SAAS,sBAAsB;IAAC,gBAAgB;SAAhB,UAAgB,EAAhB,qBAAgB,EAAhB,IAAgB;QAAhB,2BAAgB;;IACxE,IAAM,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC5B,IAAM,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAEzB,IAAI,CAAC,MAAM,EAAE;QACX,OAAO;KACR;IAED,IAAM,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;IAEtC,IAAI,QAAQ,EAAE;QAEZ,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KAC/B;SAAM;QAEL,wBAAwB,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;KAChD;CACF,CAAC;AAEF,MAAM,CAAC,mBAAmB,GAAG,SAAS,yBAAyB;IAAC,gBAAgB;SAAhB,UAAgB,EAAhB,qBAAgB,EAAhB,IAAgB;QAAhB,2BAAgB;;IAC9E,IAAM,SAAS,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAC5B,IAAM,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAEzB,IAAI,CAAC,MAAM,EAAE;QACX,OAAO;KACR;IAED,IAAM,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;IAEtC,IAAI,QAAQ,EAAE;QACZ,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,UAAC,EAAE,EAAE,KAAK;YAC9B,IAAG,EAAE,KAAK,MAAM,EAAC;gBAEf,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;gBAClC,OAAO,IAAI,CAAC;aACb;SACF,CAAC,CAAC;KACJ;SAAM;QAEL,2BAA2B,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;KACnD;CACF,CAAC;AAOF,SAAgB,eAAe;IAAC,0BAA6B;SAA7B,UAA6B,EAA7B,qBAA6B,EAA7B,IAA6B;QAA7B,qCAA6B;;IAC3D,gBAAgB,CAAC,OAAO,CAAC,UAAC,SAAS;QAEjC,wBAAwB,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,YAAY,CAAC,CAAC;QAC/D,SAAS,CAAC,SAAS,CAAC,GAAG;YACrB,UAAU,EAAE,YAAY;YACxB,OAAO,EAAE,EAAE;SACZ,CAAC;QAEF,SAAS,YAAY,CAAC,KAAY;YAChC,IAAM,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;YAEtC,IAAM,IAAI,GAAG,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;YAE7C,IAAI,CAAC,KAAK,CAAC,CAAC;SACb;KACF,CAAC,CAAC;CACJ;AAOD,SAAgB,qBAAqB;IAAC,0BAA6B;SAA7B,UAA6B,EAA7B,qBAA6B,EAA7B,IAA6B;QAA7B,qCAA6B;;IACjE,gBAAgB,CAAC,OAAO,CAAC,UAAC,SAAS;QACjC,IAAM,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;QAEtC,IAAG,QAAQ,EAAC;YACV,2BAA2B,CAAC,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC;YACzE,OAAO,SAAS,CAAC,SAAS,CAAC,CAAC;SAC7B;KACF,CAAC,CAAC;CACJ;;;;"}